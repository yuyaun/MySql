#SQL编程

sql是一种编程语言，用来解决关系数据库中的相关问题。sql编程就是通过sql语句来解决特定问题的一种编程方式。

>
	MYSQL 数据库历史

1979年 Monty Windenius 为TcX 用BASIC设计了一个报表工具。后用C重新移植到UNIX平台，这个存储引擎叫做Unireg。

1996年MySQL 1.0 

1996年10月 MySQL3.11.1 开始提供Solaris下的二进制版本。11，linux版本出现。

1998年1月 发布关系行数据库。它使用系统核心的多线程机制提供完全的多线程运行模式，并提供多种编程接口。

1999～2000年 Berkeley DB 引擎开发完成。BDB支持事物处理。

2000 年4月 ISAM 整理为MyISAM 

2001 年 Heikki Tuuri 提出集成他的InnoDB 引擎，支持事物处理及行锁。

2003年 MySQL5.0 提供了视图，存储过程等功能。

2008年 Sun公司收购。

2008年8月 MySQL5.1发布，提供了分区，事件管理，以及基于行的复制和基于磁盘的NDB集群系统。

2009年 Oracle 收购Sun公司，InnoDB 在2005年就被收购了。

2010 年12月 MySQL5.5发布，新特性半同步的复制及对SIGNAL/RESIGNAL的异常处理功能的支持。InnoDB未默认存储引擎。

>
>
	MySQl分支
>

>
	SQL编程

几个编程阶段
*	1.面向过程化的SQL编程。
	使用数据库，没有多少处理关系模型的经验和基于集合的思想。滥用各种工具，游标，临时表，动态SQL语句等，并且自己意识不到。
*	2.面向集合的SQL编程。
	意识到SQL与面向过程和对象编程的不同之处，知道运用SQL编程需要更多的东西，发现它是基于关系模型集合理论的强打产物。
	开始相信，说游标，临时表，动态SQL有害二永远不使用的“专家”。
*	3.融合SQL编程
	具有丰富的知识并对SQL有了深入的理解。能够判断什么时候使用纯净太的SQL编程方法不能完成某些任务的能力。
	有时候，使用临时表可以显著改善性能，动态SQL可以解决复杂的问题，适当地使用游标可以提高程序运行的效率。

>

### 数据库的应用类型

	第一要了解进行SQL编程的对象类型。即要开发的数据库应是那种类型。
	OLTP onLine Transaction Processing 联机事物处理
	OLAP OnLine Analysis Processing 联机分析处理
	
	OLTP是传统关系行数据库的主要应用，面向基本的日常的事物处理，如银行交易。
	OLAP 是数据仓库系统的主要应用，支持复杂的分析操作，侧重决策支持，并且提供直观易懂的查询结果。
	
### OLTP
	
	面向交易的处理系统，特征是可以立即将顾客的原始数据传送到计算中心进行处理，并在很短的时间内给出处理结果，
这个过程最大的有限是可以及时地处里输入的数据，即使地回答，因此OLTP又被成为实施系统 Real Time System。
衡量OLTP系统的重要指标 系统性能 体现为 实施响应时间 ResponseTime 
即从客户端输入到计算机对着个请求所需的时间。
OLTP 数据库 旨在使事务应用程序仅完成对所需的写入，一边尽快处理单个事务。
	OLTP 数据库的特征

*	支持大量并发用户定期添加和修改数据
*	反映随时变化的单位状态，但不保存其历史记录
*	包含大量数据，其中包括用于验证事务的大量数据
*	具有复杂的结构
*	可以进行优化以及对事务活动做出响应
*	提供用于支持单位日常运营的技术基本结构
*	个别事务能偶很快的完成，并且只需访问相对较少的数据。OLTP系统旨在处理同时输入的成百上千的事务。


###	OLAP 

	OLAP 由关系数据库之父E.F.Codd 博士于1993年提出，是一种用于组织大型商务数据库和支持商务只能的技
	
	 OLAP 是共享多维系信息的，针对特定的联机数据访问和分析的快速软件技术。
    它通过对信息的多种可能的观察形式进行快速，稳定以致和交互性的存取，允许管理决策人员
    对数据进行深入观察。决策数据是多维数据，是决策的主要内容。
    OLAP专门用于支持复杂的分析操作，侧重对决策人员和高层管理人员的决策支持。

---
    OLAP具有灵活的分析功能，直观的数据操作和分析结果可视化表示等突出优点。可以证实提出的复杂假设，
    是以图形或表格的形式来表示对信息的总结。OLAP并不将异常信息标记出来，采取的是一种知识证实的方式。
    OLAP的主要特点是直接仿照用户的多角度思考模式，预先为用户组建多维的数据模型。
```
维是指用户的分析角度，
	例如 销售数据的分析，时间周期是一个维度，产品类别，分销渠道，地理分布，客户群类等维度。
一旦多为数据模型建立完成，用户可以快速地从各个分析角度获取数据，也能动态地在各个角度之间切换数据或进行多角度综合分析，具有极大的分析灵活性
```

###OLAP 的基本概念
 
*	维 Dimension ：是用户观察数据的特定角度，是问题的一类属性，属性集合构成一个维（时间维，地理维）
*	维的层次 Level ：用户观察数据的某个特定角度（即某个维）
			 还可能存在细节程度不同的各个描述方面（时间维包括日期，月份，季度，年）
*	维的成员 Member：即维的一个取值，是数据项在某个维中的描述，如“某年某月某天”是在时间维上的位置描述。
*	度量 Measure：多维数组的取值

---
OLAP的基本多为分析操作包括钻取（Drill-up和Drill-down），切片（Slice）和切块（Dice）以及旋转（Pivot）等。

*	钻取：改变维德层次，变换维维德粒度。包括向下钻取和向上钻取/上滚（Roll-up）。
		向上钻取是在某一维将低层次的细节数据概括到高层次的汇总数据，或者减少维数；
		向下钻取相反，从汇总数据深入到细节数据进行观察或者增加新维。
*	切片和切块：在一部分维上选定值后，关心度量数据在剩余维上的分布。如果剩余的维只有两个，则是切片；
		    如果三个以上，则是切片。
*	旋转：变换的方向，即在表格中重新安排维的放置（如行列互换）

###OLTP 与OLAP 的比较
   
	OLTP主要执行基本的，日常事务处理，比如在银行存取一笔款，是一个事务交易。
>*		实时性要求高。
>*		查询的数据量不是很大
>*		交易一般是确定的，所以OLTP是对确定性的数据进行存取
>*		并发性要求高，并且严格要求事务的完整性，安全性

	OLAP 是数据仓库系统的主要应用，其典型的应用就是复杂的动态报表系统。

>*		实时性要求不是很高，很多应用最多每天更新一次数据。
>*		数据量大。因为OLAP支持的是动态查询，用户要求通过很多的数据的统计才能想到要
>*		知道的信息，如时间序列分析等，所以处理的数据量很大。
>*		因为重点在于决策支持，所以查询一般是动态的，也就是说允许用户随时提出查询的要求。
>*		因此，在OLTP中通过一个重要的概念‘维’来搭建一个动态查询的平台，提供用户自己决定需要知道的信息。

|-----    |OLTP             |OLAP           |
|-----    |---:             |---:           |
|用户     |操作人员         |决策人员       |
|功能     |日常操作处理      |分析决策       |
|DB设计   |面向应用         |面向主题       |
|数据     |当前的，最新的    |历史的，聚集的  |
|存取     |读/写数十条记录   |度上百万的数据  |
|工作单位  |简单的事务        |复杂的查询     |
|用户数   |上千个           |上百个         |
|DB大小   |一般小于500GB    |大于1TB        |

---
##MySQL存储引擎及其面向的数据库应用

*   MySQL数据库的体系结构
    >连接池组建 (Connection Pool)
    >管理服务和工具组件（Management Services &Utilities）
    >SQL接口组件 （SQL Interface）
    >查询分析器组件（Parser）
    >优化器组建 （Optimizer）
    >缓冲组件 （Caches & Buffers）
    >插件式存储引擎 （Pluggable Storage Engines）
    >物理文件 （File system）

SQL解析器，SQL优化器，缓冲池，存储引擎 是数据库标配，但不是每个数据库都有很多存储引擎。
MySQL插件式的存储引擎可以根据自己需求选择（InnoDB 可以先被收购）

####主要存储引擎介绍
*   InnoDB 存储引擎：支持事务，主要面向联机事务处理（OLTP）的应用。
>
    特点是行锁设计，支持外键，并支持类似Oracle的非锁定读，即默认不锁

    数据存在于一个逻辑的表空间中，这个表空间有InnoDB存储引擎自身管理
     
    还可以将每个表单独存在到一个独立的ibd文件中
 
    支持裸设备 row disk 用于建立表空间
    
    使用多版本并发控制（MVCC）来获得高并发性，并且实现了SQL标准的4种隔离级别。默认REPEATABLE 级别，使用netx-key locking的策略来避免幻读 phantom现象。
    
    *插入缓冲 insert buffer
    
    *二次读写 double write
    
    *自适应哈希索引 adaptive hash index
    
    *预读 read ahead
    
    存储采用了聚集 clustered 的方式，每张表都是按主键的顺序进行存储的
   如果没有显式地在标定义时指定主键，InnoDB存储引擎会为每一行生成一个6字节的ROWID，并以此作为主键
>

*   MyISAM 存储引擎
>
    不支持事务，表锁设计，支持全文索引，主要面向一些OLAP数据库应用。
缓冲池置换缓存（cacahe）索引文件，而不缓存数据文件。
>
    
*   NDB存储索引
> 
    集群存储引擎,其结构是share nothing的技去架构。特点是数据全部放在内存中，主键查找 primary key lookups 速度极快，并且能够添加存储节点 data node，高可用高扩展 面向OLTP的数据库。
>

*   Memory 存储引擎
>
    数据全部放在内存中。适合OLTP数据库应用中临时数据的临时表，也可以作为OLAP数据库应用中数据库仓库的维度表。Memory存储引擎默认使用哈西索引，而不是通常的B+树索引。
>
